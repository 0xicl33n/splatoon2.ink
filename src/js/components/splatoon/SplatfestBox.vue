<template>
    <div class="font-splatoon2" :class="{ 'has-results': results }">
        <div class="splatfest-header">
            <h2 class="title is-3 is-size-2-fullhd font-splatoon1">
                {{ title }}
            </h2>
        </div>

        <div class="panel-container" :class="{ 'is-hidden-mobile' : results }">
            <div class="image panel-image">
                <img :src="image" />
            </div>

            <div class="labels">
                <div class="alpha">
                    {{ $t(`splatnet.festivals.${festival.festival_id}.names.alpha_short`, festival.names.alpha_short) }}
                </div>

                <div class="bravo">
                    {{ $t(`splatnet.festivals.${festival.festival_id}.names.bravo_short`, festival.names.bravo_short) }}
                </div>
            </div>

            <SplatfestResultsBox :festival="festival" :results="results" v-if="results && !screenshotMode" />
        </div>

        <div class="mobile-results is-hidden-tablet" v-if="results">
            <SplatfestResultsBox :festival="festival" :results="results" v-if="results && !screenshotMode" />
        </div>

        <div class="has-text-centered is-size-5 title-color festival-period-container" v-if="!screenshotMode">
            <div class="festival-period" :style="{ 'background-color': festival.colors.middle.css_rgb }">
                <span class="nowrap">
                    {{ festival.times.start | date({ weekday: 'short' }) }}
                    {{ festival.times.start | time }}
                </span>
                &ndash;
                <span class="nowrap">
                    {{ festival.times.end | date }}
                    {{ festival.times.end | time }}
                </span>
            </div>
        </div>

        <div class="splatfest-content has-text-centered" v-if="!screenshotMode">
            <template v-if="state == 'upcoming' || state == 'active'">
                {{ formattedDuration }}
            </template>

            <template v-else-if="state == 'past' && !results && festival.times.result > now">
                {{ resultsIn }}
            </template>
        </div>

        <div class="has-text-centered is-size-5 title-color festival-period-container" v-if="screenshotMode">
            <div class="festival-period" :style="{ 'background-color': festival.colors.middle.css_rgb }" v-if="state == 'upcoming' || state == 'active'">
                {{ screenshotModeDuration }}
            </div>
            <div v-else>&nbsp;</div>
        </div>
    </div>
</template>

<script>
import Vue from 'vue';
import SplatfestResultsBox from './SplatfestResultsBox.vue';

export default {
    components: { SplatfestResultsBox },
    props: ['festival', 'results', 'now', 'screenshotMode'],
    computed: {
        state() {
            if (this.festival.times.start > this.now)
                return 'upcoming';
            if (this.festival.times.end > this.now)
                return 'active';
            return 'past';
        },
        title() {
            if (this.state == 'upcoming')
                return this.$t('splatfest.upcoming');
            if (this.state == 'past' && !this.screenshotMode)
                return this.$t('splatfest.recent');
            return this.$t('splatfest.title');
        },
        image() {
            if (this.festival)
                return Vue.filter('localSplatNetImageUrl')(this.festival.images.panel) + '?1';
        },
        formattedDuration() {
            let time;

            switch (this.state) {
                case 'upcoming':
                    time = Vue.filter('duration')(this.festival.times.start - this.now);
                    return this.$t('time.in', { time });
                case 'active':
                    time = Vue.filter('duration')(this.festival.times.end - this.now);
                    return this.$t('time.remaining', { time });
            }
        },
        resultsIn() {
            let time = Vue.filter('duration')(this.festival.times.result - this.now);
            return this.$t('splatfest.results_in', { time });
        },
        screenshotModeDuration() {
            let time;

            switch (this.state) {
                case 'upcoming':
                    time = Vue.filter('shortDuration')(this.festival.times.start - this.now);
                    return this.$t('time.in', { time });
                case 'active':
                    time = Vue.filter('durationHours')(this.festival.times.end - this.now);
                    return this.$t('time.remaining', { time });
            }
        },
    }
}
</script>
